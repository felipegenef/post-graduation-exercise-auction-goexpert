# Auction API - Golang

**VersÃ£o em PortuguÃªs (English version below)**

## ðŸ“Œ DescriÃ§Ã£o

Este projeto Ã© uma API desenvolvida como parte de um exercÃ­cio de pÃ³s-graduaÃ§Ã£o em Golang. A API implementa um sistema de leilÃ£o onde Ã© possÃ­vel cadastrar leilÃµes e registrar ofertas (bids) para cada item leiloado. Os dados sÃ£o armazenados em um banco MongoDB.

Entre os recursos implementados estÃ£o:

- Suporte Ã  concorrÃªncia com goroutines, mutexes e channels;
- VariÃ¡veis de ambiente configurÃ¡veis, como:
  - URL do banco de dados;
  - Tamanho do batch de ofertas a serem processadas;
  - Intervalo de tempo entre ofertas;
  - Tempo de duraÃ§Ã£o do leilÃ£o (`AUCTION_INTERVAL`);
- Fechamento automÃ¡tico e manual de leilÃµes com base em tempo ou sinais enviados por channel.

> Os testes automatizados se concentram na funcionalidade de fechamento automÃ¡tico e manual dos leilÃµes, conforme requerido no exercÃ­cio.

---

## âœ… Requisitos do ExercÃ­cio

Objetivo: adicionar uma funcionalidade de **fechamento automÃ¡tico** de leilÃµes com base em tempo.

### Funcionalidades solicitadas:

- Uma funÃ§Ã£o que calcule o tempo de expiraÃ§Ã£o de um leilÃ£o com base nas variÃ¡veis de ambiente;
- Uma goroutine que monitore leilÃµes ativos e os feche quando expirados;
- Testes automatizados validando essa funcionalidade.

> Dica: concentre-se principalmente no arquivo `internal/infra/database/auction/create_auction.go`. Lembre-se de tratar corretamente as condiÃ§Ãµes de concorrÃªncia.

---

## ðŸ§ª Como Testar a API

### 1. Subir banco de dados de teste

Utilize o docker-compose para subir o MongoDB local:

Comando: docker compose up mongodb

### 2. Executar os testes

Comando: go test ./internal/infra/database/auction -v

---

## ðŸ”¬ ExplicaÃ§Ã£o dos Testes

### âœ… TestAuctionAutoClose

Verifica se o leilÃ£o Ã© fechado automaticamente apÃ³s o tempo definido em `AUCTION_INTERVAL`.

- Cria um leilÃ£o com tempo de expiraÃ§Ã£o definido em 2 segundos;
- Executa duas goroutines simultÃ¢neas:
  - A primeira, apÃ³s 1 segundo, verifica se o leilÃ£o ainda estÃ¡ aberto;
  - A segunda, apÃ³s 3 segundos, verifica se o leilÃ£o foi fechado corretamente.

### âœ… TestAuctionManualClose

Valida o encerramento **manual** de um leilÃ£o via channel.

- Cria um leilÃ£o e armazena seu controle no repositÃ³rio com mutexes;
- Realiza uma verificaÃ§Ã£o inicial para garantir que estÃ¡ aberto;
- Envia um sinal via channel para forÃ§ar o fechamento;
- ApÃ³s 1 segundo, verifica se o leilÃ£o foi corretamente encerrado no banco de dados.

---

# ðŸ English Version

## ðŸ“Œ Description

This project is an API built as part of a postgraduate exercise in Golang. It implements an auction system where you can register auctions and submit bids for each auctioned item. All data is stored in a MongoDB database.

Key features include:

- Concurrency handling using goroutines, mutexes, and channels;
- Environment variables for:
  - MongoDB connection URL;
  - Bid batch size;
  - Bid insertion interval;
  - Auction duration (`AUCTION_INTERVAL`);
- Automatic and manual auction closing mechanisms.

> Automated tests were added to ensure correct implementation of auction closing features.

---

## âœ… Exercise Requirements

Goal: Implement an **automatic auction closing** feature based on a predefined time.

### Required features:

- A function that calculates auction duration using environment variables;
- A goroutine that checks for expired auctions and updates their status;
- Unit tests validating the automatic closure behavior.

> Tip: focus on `internal/infra/database/auction/create_auction.go`. Pay close attention to concurrency control.

---

## ðŸ§ª How to Test the API

### 1. Start MongoDB test database

Use docker-compose to start the local MongoDB instance:

Command: docker compose up mongodb

### 2. Run the tests

Command: go test ./internal/infra/database/auction -v

---

## ðŸ”¬ Test Explanations

### âœ… TestAuctionAutoClose

Tests automatic auction closing using the `AUCTION_INTERVAL` environment variable.

- Creates an auction with a 2-second duration;
- Runs two goroutines:
  - The first waits 1 second and checks if the auction is still open;
  - The second waits 3 seconds and checks that the auction is now closed.

### âœ… TestAuctionManualClose

Tests **manual** auction closing using a channel.

- Creates an auction and registers control metadata (including a close channel) in a map with mutex protection;
- First, verifies that the auction is open;
- Then sends a signal to the auctionâ€™s close channel;
- After a 1-second wait, verifies that the auction has been properly closed in the database.

---
